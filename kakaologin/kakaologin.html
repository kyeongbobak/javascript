<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
  <!-- javascript sdk를 로드하는 코드, 이 코드를 사용하면 웹페이지에서 kakao의 다양한 기능을 활용할 수 있게 됩니다. kakao의 로그인, 메시지 전송, 친구목록 조회 등등과 같은 다양한 기능을 제공합니다. 
  아래 코드는 이러한 kakao 기능들을 활용하기 위해 필요한 sdk를 불러오는 역할을 합니다. -->
  <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.5.0/kakao.min.js"
    integrity="sha384-kYPsUbBPlktXsY6/oNHSUDZoTX6+YI51f63jCPEIPFP09ttByAdxd2mEjKuhdqn4"
    crossorigin="anonymous"></script>
</head>

<body>
  <a id="kakao-login-btn" href="">
    <!-- 로그인 버튼을 클릭했을 때 login 성공시 사용자 정보를 받아오기 위해서 함수를 추가한거지 -->
    <img src="img/kakao_login_medium_wide.png" onclick="loginWithKakao()" width="222" alt="카카오 로그인 버튼" />
  </a>

  <p id="token-result"></p>
  <script>

    // 1. SDK를 초기화
    // sdk 초기화 시에는 보안 및 인증을 위한 키 정보가 필요합니다. 
    // 개발자는 카카오 개발자 사이트에서 애플리케이션을 등록하고 
    // 등록한 애플리케이션에 대한 인증정보(보통은 앱 키나 클라이언트 ID 등)을 받아옵니다. 
    // 이 키는 Kakao API를 호출하기 위한 인증 수단으로 사용됩니다. 

    // 다음 함수에 전달된 파라미터 역시 애플리케이션 인증 키 또한 클라이언트 ID같은 것으로 보여집니다. 이 키를 사용하여 Kakao SDK가 카카오 서버에 연결하고, 애플리케이션에 필요한 권한을 요청하여 해당 애플리케이션에서 카카오 API를 사용할 수있는 권한을 얻게 됩니다. 
    // sdk를 초기화 하는 이유는 카카오의 다양한 기능을 활용하기 위해서입니다. 
    Kakao.init('')
    // 초기화가 잘 되었는지 확인 결과 true
    console.log(Kakao.isInitialized())


    // 로그인 버튼을 클릭했을 때 실행되는 함수인거야 
    function loginWithKakao() {

    }

    function loginWithKakao() {
      Kakao.Auth.login({
        success: function (authObj) {
          console.log(authObj); //access토큰 값
          Kakao.Auth.setAccessToken(authObj.access_token); //access 토큰 값 저장
          getInfo();
        },
        fail: function (err) {
          console.log(err);
        },
      });
    }


    function loginWithKakao() {
      Kakao.Auth.authorize({
        redirectUri: 'http://127.0.0.1:5500/kakaologin.html',
      });
    }

    displayToken()
    function displayToken() {
      var token = getCookie('authorize-access-token');

      if (token) {
        Kakao.Auth.setAccessToken(token);
        Kakao.Auth.getStatusInfo()
          .then(function (res) {
            if (res.status === 'connected') {
              document.getElementById('token-result').innerText
                = 'login success, token: ' + Kakao.Auth.getAccessToken();
            }
            console.log(res)
          })
          .catch(function (err) {
            Kakao.Auth.setAccessToken(null);
          });
      }
    }

    function getCookie(name) {
      var parts = document.cookie.split(name + '=');
      if (parts.length === 2) { return parts[1].split(';')[0]; }
    }

  </script>
</body>

</html>